{
    "contents" : "require(plyr)\nrequire(pls)\nrequire(reshape2)\n\nDB <- read.csv(\"data/BaseNormalizada2.csv\", stringsAsFactors=FALSE)\nDB$Indicador <- NULL\nDB$X <- NULL\nDB$Sentenciados.a.más.de.1.año.de.prisión <- NULL\n\nDB$AnclaCompuesta <- ((.5)*(DB$Inversión)) +\n                       ((.5)*(DB$Grado.de.escolaridad.efectiva + \n                               DB$Absorción.de.la.demanda.estudiantil + \n                               DB$Licenciados.ocupados + \n                               DB$Migrantes..nal.y.ext..con.educación.superior +\n                               DB$Investigadores ) / 5)\n\n#Principal components regression using ncomp=N(VAR)*c\nPC <- pcr( AnclaCompuesta ~Ejecución.de.contratos+Robo.de.vehículos+Competencia.en.servicios.notariales+Tasa.de.homicidios+Monto.reportado.en.robo.de.mercancías+Tierra.ejidal+Percepción.de.inseguridad+Sobreexplotación.de.acuíferos+Consumo.de.agua+Capacidad.de.tratamiento.de.agua.en.operación+Índice.de.gestión.de.calidad.del.aire+Disposición.adecuada.de.residuos.sólidos+Aprovechamiento.del.biogás.en.rellenos.sanitarios+Empresas.certificadas.como..limpia.+Desastres.naturales+Economía.intensiva.en.energía+Emergencias.ambientales+Espacios.culturales+Empresa.socialmente.responsable+Visitas.a.museos.INAH+Universidades.de.calidad+Rendimiento.académico+Escuelas.de.calidad+Mortalidad.por.diabetes+Mortalidad.infantil+Médicos+Camas.de.hospital+Acceso.a.instituciones.de.salud+Crecimiento.en.acceso.a.servicios.de.salud+Crecimiento.en.población.altamente.calificada+Viviendas.con.drenaje..sólo.conexión.a.red.pública.+Viviendas.con.piso.de.tierra+Viviendas.deshabitadas+Personas.por.debajo.de.la.línea.de.bienestar+Desigualdad.en.las.ciudades+Mujeres.en.la.fuerza.laboral+Ingreso.promedio.de.la.mujer+Duración.de.período.para.ediles.y.delegados+Participación.ciudadana+Competencia.electoral+Organizaciones.de.la.sociedad.civil+Periodistas.muertos.o.desaparecidos+Índice.de.información.presupuestal+Ingresos.propios+Apertura.de.un.negocio+Registro.de.una.propiedad+Muertes.por.infecciones.intestinales+Empleados.en.el.sector.formal+Crecimiento.en.los.empleados.en.el.sector.formal+Crecimiento.de.la.mancha.urbana+Densidad.poblacional+Salario.promedio.mensual.para.trabajadores.de.tiempo.completo+Jornadas.laborales.muy.largas....48.horas.semanales.+Crecimiento.en.jornadas.laborales.muy.largas+Productividad.media.del.trabajo+Población.ocupada.sin.ingresos+Crecimiento.de.la.población.ocupada.sin.ingresos+Demandantes.de.conflicto.laboral+Crédito.a.las.empresas+Tamaño.del.mercado.hipotecario+Cartera.hipotecaria.vencida+Sectores.que.han.presentado.alto.crecimiento..2008.2012.+Crecimiento.del.PIB.estatal+Crecimiento.del.salario.promedio+Diversificación.económica+Desempleo+Viviendas.con.líneas.telefónicas.móviles+Viviendas.con.computadora+Uso.deTwitter.como.proxy.de.uso.de.tecnologías.de.información+Muertes.por.accidentes.relacionados.con.transporte+Sistema.de.transporte.masivo+Red.carretera.avanzada+Aerolíneas+Flujo.de.pasajeros.aéreos+Líneas.de.autobús+Uso.de.servicios.financieros+Acceso.a.servicios.financieros+Consumo.de.diesel.en.transporte.de.bienes+Inversión.extranjera.directa..neta.+Flujo.de.pasajeros.del.o.hacia.el.extranjero+Oferta.hotelera.4.y.5.estrellas+Ocupacion.hotelera+Sitios.UNESCO+Ciudad.fronteriza.o.portuaria+Empresas+Grandes.empresas.según.CNN.Expansión+Empresas.certificadas.con.ISO.9000.y.14000+Centros.de.investigación+Posgrados.de.calidad + Patentes, data=DB)\n\n#Extract Full coeficient list\nCoefs <- PC$coefficients\nCoefLoadings <- c()\nfor(i in 1:72){\n  CoefLoadings <- c(CoefLoadings,as.numeric(Coefs[,,i]))\n}\nremove(i, Coefs)\nVariables <- colnames(DB)[5:94]\nCoefs <- data.frame(CoefLoadings=CoefLoadings, Variables=Variables)\nSubIndice <- t(read.csv(\"data/subindices2.csv\", stringsAsFactors=FALSE, header=FALSE))\n#SubIndice <- SubIndice[-1]\nSubIndice <- SubIndice[1:90]\nCoefs$SubIndice <- SubIndice\nremove(SubIndice, Variables, CoefLoadings)\nCoefs <- arrange(Coefs, Coefs$Variables)\nCoefs$Componente <- 1:72\nSubIndices <- unique(Coefs[,2:3])\nCoefs <- dcast(Coefs, formula= Componente ~ Variables , value.var=\"CoefLoadings\", )\n\n\n#Weigth by variable\nWeights <- data.frame(colSums(Coefs))\nVariables <- row.names(Weights)\nWeights$Variables <- Variables\nremove(Variables)\ncolnames(Weights) <- c(\"Peso\", \"Variable\")\nWeights <- Weights[-1,]\nWeights$AbPeso <- abs(Weights$Peso)\nWeights$Norm <- (Weights$AbPeso - min(Weights$AbPeso)) / (max(Weights$AbPeso - min(Weights$AbPeso))) * 100\nWeights <- merge(Weights, SubIndices, by.x=\"Variable\", by.y=1 )\n\nPesosSubIndices <- data.frame(tapply(Weights$AbPeso, Weights$SubIndice, sum))\nPesosSubIndices$Peso <- PesosSubIndices[[1]] / (sum(PesosSubIndices[[1]]))\nremove(Coefs, PC,Weights, SubIndices )\nPesosSubIndices$SubIndice <- row.names(PesosSubIndices)\nPesosSubIndices <- PesosSubIndices[,3:2]\nPesosSubIndices <- arrange(PesosSubIndices, desc(PesosSubIndices$Peso))\nwrite.csv(PesosSubIndices, \"data-out/PesosSubIndices2.csv\", row.names=FALSE)\n\n",
    "created" : 1406911591508.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "851256317",
    "id" : "E7307C0A",
    "lastKnownWriteTime" : 1406914299,
    "path" : "~/R/IndiceCiudadesPesos/src/PCA.R",
    "project_path" : "src/PCA.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}